const samplePoolPair = [
  {
    id: "19",
    symbol: "BTC-DFI",
    displaySymbol: "dBTC-DFI",
    name: "Playground BTC-Default Defi token",
    status: true,
    tokenA: {
      symbol: "BTC",
      displaySymbol: "dBTC",
      id: "1",
      name: "Playground BTC",
      reserve: "1000",
      blockCommission: "0",
    },
    tokenB: {
      symbol: "DFI",
      displaySymbol: "DFI",
      id: "0",
      name: "Default Defi token",
      reserve: "1000",
      blockCommission: "0",
    },
    priceRatio: {
      ab: "1",
      ba: "1",
    },
    commission: "0",
    totalLiquidity: {
      token: "1000",
      usd: "20000000",
    },
    tradeEnabled: true,
    ownerAddress: "mswsMVsyGMj1FzDMbbxw2QW3KvQAv2FKiy",
    rewardPct: "0.05882352",
    rewardLoanPct: "0",
    creation: {
      tx: "47f35e7b540fbc920a69fdc9ae13165769f1fdc23cdfad150ee74dbf0bc545e7",
      height: 141,
    },
    apr: {
      reward: 39.34269958752,
      commission: 0,
      total: 39.34269958752,
    },
    volume: {
      h24: 0,
      d30: 0,
    },
  },
  {
    id: "20",
    symbol: "ETH-DFI",
    displaySymbol: "dETH-DFI",
    name: "Playground ETH-Default Defi token",
    status: true,
    tokenA: {
      symbol: "ETH",
      displaySymbol: "dETH",
      id: "2",
      name: "Playground ETH",
      reserve: "100000",
      blockCommission: "0",
    },
    tokenB: {
      symbol: "DFI",
      displaySymbol: "DFI",
      id: "0",
      name: "Default Defi token",
      reserve: "1000",
      blockCommission: "0",
    },
    priceRatio: {
      ab: "100",
      ba: "0.01",
    },
    commission: "0",
    totalLiquidity: {
      token: "10000",
      usd: "20000000",
    },
    tradeEnabled: true,
    ownerAddress: "mswsMVsyGMj1FzDMbbxw2QW3KvQAv2FKiy",
    rewardPct: "0.05882353",
    rewardLoanPct: "0",
    creation: {
      tx: "56e0b30c535d705f1644d8ff567df34157d21b52bde9555b0715acc4fc9d4c56",
      height: 144,
    },
    apr: {
      reward: 39.34270627578,
      commission: 0,
      total: 39.34270627578,
    },
    volume: {
      h24: 0,
      d30: 0,
    },
  },
  {
    id: "21",
    symbol: "USDT-DFI",
    displaySymbol: "dUSDT-DFI",
    name: "Playground USDT-Default Defi token",
    status: true,
    tokenA: {
      symbol: "USDT",
      displaySymbol: "dUSDT",
      id: "3",
      name: "Playground USDT",
      reserve: "10000000",
      blockCommission: "0",
    },
    tokenB: {
      symbol: "DFI",
      displaySymbol: "DFI",
      id: "0",
      name: "Default Defi token",
      reserve: "1000",
      blockCommission: "0",
    },
    priceRatio: {
      ab: "10000",
      ba: "0.0001",
    },
    commission: "0",
    totalLiquidity: {
      token: "100000",
      usd: "20000000",
    },
    tradeEnabled: true,
    ownerAddress: "mswsMVsyGMj1FzDMbbxw2QW3KvQAv2FKiy",
    rewardPct: "0.05882353",
    rewardLoanPct: "0",
    creation: {
      tx: "c9c043915c256554b2efc41b269621d9cc412874f3d8153ee1a39354dd1e2a1a",
      height: 147,
    },
    apr: {
      reward: 39.34270627578,
      commission: 0,
      total: 39.34270627578,
    },
    volume: {
      h24: 0,
      d30: 0,
    },
  },
  {
    id: "22",
    symbol: "LTC-DFI",
    displaySymbol: "dLTC-DFI",
    name: "Playground LTC-Default Defi token",
    status: true,
    tokenA: {
      symbol: "LTC",
      displaySymbol: "dLTC",
      id: "4",
      name: "Playground LTC",
      reserve: "10000",
      blockCommission: "0",
    },
    tokenB: {
      symbol: "DFI",
      displaySymbol: "DFI",
      id: "0",
      name: "Default Defi token",
      reserve: "100",
      blockCommission: "0",
    },
    priceRatio: {
      ab: "100",
      ba: "0.01",
    },
    commission: "0",
    totalLiquidity: {
      token: "1000",
      usd: "2000000",
    },
    tradeEnabled: true,
    ownerAddress: "mswsMVsyGMj1FzDMbbxw2QW3KvQAv2FKiy",
    rewardPct: "0.05882353",
    rewardLoanPct: "0",
    creation: {
      tx: "4b4789b0ff718c91b30c6cd311ce6279fda04c4c26aefaf36472dd02ef39ea24",
      height: 150,
    },
    apr: {
      reward: 393.4270627578,
      commission: 0,
      total: 393.4270627578,
    },
    volume: {
      h24: 0,
      d30: 0,
    },
  },
  {
    id: "23",
    symbol: "USDC-DFI",
    displaySymbol: "dUSDC-DFI",
    name: "Playground USDC-Default Defi token",
    status: true,
    tokenA: {
      symbol: "USDC",
      displaySymbol: "dUSDC",
      id: "5",
      name: "Playground USDC",
      reserve: "20000000",
      blockCommission: "0",
    },
    tokenB: {
      symbol: "DFI",
      displaySymbol: "DFI",
      id: "0",
      name: "Default Defi token",
      reserve: "2000",
      blockCommission: "0",
    },
    priceRatio: {
      ab: "10000",
      ba: "0.0001",
    },
    commission: "0",
    totalLiquidity: {
      token: "200000",
      usd: "40000000",
    },
    tradeEnabled: true,
    ownerAddress: "mswsMVsyGMj1FzDMbbxw2QW3KvQAv2FKiy",
    rewardPct: "0.05882353",
    rewardLoanPct: "0",
    creation: {
      tx: "b24e3d0ce0c00d5593c14ab16e930dd4b9bbf128530e1bb03bd32bd9fb9e35cb",
      height: 153,
    },
    apr: {
      reward: 19.67135313789,
      commission: 0,
      total: 19.67135313789,
    },
    volume: {
      h24: 0,
      d30: 0,
    },
  },
  {
    id: "24",
    symbol: "DUSD-DFI",
    displaySymbol: "DUSD-DFI",
    name: "Decentralized USD-Default Defi token",
    status: true,
    tokenA: {
      symbol: "DUSD",
      displaySymbol: "DUSD",
      id: "14",
      name: "Decentralized USD",
      reserve: "10001160",
      blockCommission: "0",
    },
    tokenB: {
      symbol: "DFI",
      displaySymbol: "DFI",
      id: "0",
      name: "Default Defi token",
      reserve: "10000116",
      blockCommission: "0",
    },
    priceRatio: {
      ab: "1.00010439",
      ba: "0.99989561",
    },
    commission: "0.02",
    totalLiquidity: {
      token: "10000116",
      usd: "20002320",
    },
    tradeEnabled: true,
    ownerAddress: "mswsMVsyGMj1FzDMbbxw2QW3KvQAv2FKiy",
    rewardPct: "0.05882353",
    rewardLoanPct: "0",
    creation: {
      tx: "30b3501edd4a90bac9939ab1a33597fff7ad783f5ed7ae4a4dd85e9858aee299",
      height: 156,
    },
    apr: {
      reward: 39.338143051186066,
      commission: 0,
      total: 39.338143051186066,
    },
    volume: {
      h24: 0,
      d30: 0,
    },
  },
];

context("Wallet - DEX - Available Pool Pairs", { testIsolation: false }, () => {
  before(() => {
    cy.intercept("**/poolpairs?size=*", {
      body: {
        data: [],
      },
      delay: 3000,
    });
    cy.clearAllCookies();
    cy.clearAllLocalStorage();
    cy.createEmptyWallet(true);
    cy.getByTestID("bottom_tab_dex").click();
  });

  beforeEach(() => {
    cy.intercept("**/poolpairs?size=*", {
      body: {
        data: samplePoolPair,
      },
    });
  });

  it("should display skeleton loader when API has yet to return", () => {
    cy.getByTestID("dex_skeleton_loader").should("exist");
    cy.sendDFItoWallet().sendTokenToWallet(["ETH"]).wait(4000);
  });

  it("should not display skeleton loader when API has return", () => {
    cy.intercept("**/poolpairs?size=*").as("getPoolpairs");
    cy.wait("@getPoolpairs").then(() => {
      cy.getByTestID("dex_skeleton_loader").should("not.exist");
    });
  });

  it("should display 6 available pool pair", () => {
    cy.intercept("**/poolpairs?size=*", {
      body: {
        data: samplePoolPair,
      },
      delay: 3000,
    });
    cy.getByTestID("available_liquidity_tab")
      .getByTestID("pool_pair_row")
      .should("have.length", 6);
  });

  it("should have DUSD-DFI PoolPair as 2th", () => {
    cy.getByTestID("pool_pair_row_1_DUSD-DFI").should("exist");
  });

  it("should place favourite on top of the list", () => {
    cy.getByTestID("favorite_pair_24").click();
    cy.wait(1000);
    cy.getByTestID("pool_pair_row_0_DUSD-DFI").should("exist");
  });

  it("should not display any pool pair at initial state of search", () => {
    cy.getByTestID("dex_search_icon").click();
    cy.getByTestID("pool_pair_row").should("not.exist");
  });

  it("should be able to search available poolpair by querying in search input", () => {
    cy.getByTestID("dex_search_input").type("btc-dfi");
    cy.getByTestID("pool_pair_row_0_dBTC-DFI").should("exist");
  });

  it("should not display any pool pair with non-exist query", () => {
    cy.getByTestID("dex_search_input").clear().type("foo");
    cy.getByTestID("available_liquidity_tab")
      .getByTestID("pool_pair_row")
      .should("not.exist");
    cy.getByTestID("dex_search_input").clear();
    cy.getByTestID("dex_search_input_close").click();
  });

  it("should display available pair values correctly", () => {
    cy.getByTestID("dex_tabs_AVAILABLE_POOL_PAIRS_active").click();
    cy.getByTestID("pool_pair_row_3_dETH-DFI").should("exist").click();

    cy.getByTestID("price_rate_tokenA_value").should(
      "have.text",
      "0.01000000 DFI",
    );
    cy.getByTestID("price_rate_tokenB_value").should(
      "have.text",
      "100.00000000 dETH",
    );
    cy.getByTestID("pooled_tokenA_value").should(
      "have.text",
      "100,000.00000000 dETH",
    );
    // (1000 / 100000) * (10000000 / 1000) * 100,000 ETH
    cy.getByTestID("pooled_tokenA_value_rhsUsdAmount").should(
      "have.text",
      "$10,000,000.00",
    );
    cy.getByTestID("pooled_tokenB_value").should(
      "have.text",
      "1,000.00000000 DFI",
    );
    // (10000000 / 1000) * 1,000 DFI
    cy.getByTestID("pooled_tokenB_value_rhsUsdAmount").should(
      "have.text",
      "$10,000,000.00",
    );

    cy.getByTestID("total_liquidity_value").should(
      "have.text",
      "10,000.00000000",
    );
    cy.getByTestID("total_liquidity_value_rhsUsdAmount").should(
      "have.text",
      "$20,000,000.00",
    );

    // 39.3427 * 100
    cy.getByTestID("apr_total_value").should("have.text", "3,934.27%");
  });

  it("should be able to prepare direct swap", () => {
    cy.getByTestID("poolpair_token_details_composite_swap").click().wait(5000);
    cy.getByTestID("MAX_amount_button").click().wait(3000);

    cy.getByTestID("button_confirm_submit").should("not.have.attr", "disabled");
    cy.getByTestID("bottom_tab_dex").click();
  });
});

context("Wallet - DEX - Your Pool Pairs", { testIsolation: false }, () => {
  beforeEach(() => {
    cy.clearAllCookies();
    cy.clearAllLocalStorage();
    cy.createEmptyWallet(true);
    cy.sendTokenToWallet(["ETH-DFI"]).wait(3000);
    cy.getByTestID("bottom_tab_dex").click();
    cy.getByTestID("dex_tabs_YOUR_POOL_PAIRS").click().wait(1000);
  });

  it("should not display tab grouping", () => {
    cy.getByTestID("dex_button_group").should("not.exist");
  });

  it("should not display TVL", () => {
    cy.getByTestID("DEX_TVL").should("not.exist");
  });

  it("should display empty results", () => {
    cy.intercept("**/address/**/tokens?size=*", {
      body: {
        data: [],
      },
    }).as("getTokens");

    cy.wait("@getTokens").then(() => {
      cy.getByTestID("empty_active_poolpair").should("not.exist");
    });
  });

  it("should not display favourite button", () => {
    cy.getByTestID("favorite_pair_20").should("not.exist");
  });

  it("should display your pool pair values correctly", () => {
    cy.intercept("**/poolpairs?size=*", {
      body: {
        data: samplePoolPair,
      },
    }).as("getPoolPairs");

    cy.wait("@getPoolPairs").then(() => {
      cy.wait(1000);
      cy.getByTestID("pool_pair_row_0_dETH-DFI").click();
      cy.getByTestID("total_liquidity_value").should(
        "have.text",
        "10,000.00000000",
      );
      cy.getByTestID("total_liquidity_value_rhsUsdAmount").should(
        "have.text",
        "$20,000,000.00",
      );
      cy.getByTestID("pooled_tokenA_value").should(
        "have.text",
        "100,000.00000000 dETH",
      );
      // (1000 / 100000) * (10000000 / 1000) * 100,000 ETH
      cy.getByTestID("pooled_tokenA_value_rhsUsdAmount").should(
        "have.text",
        "$10,000,000.00",
      );
      cy.getByTestID("pooled_tokenB_value").should(
        "have.text",
        "1,000.00000000 DFI",
      );
      // (10000000 / 1000) * 1,000 DFI
      cy.getByTestID("pooled_tokenB_value_rhsUsdAmount").should(
        "have.text",
        "$10,000,000.00",
      );

      cy.getByTestID("price_rate_tokenA_value").should(
        "have.text",
        "0.01000000 DFI",
      );
      cy.getByTestID("price_rate_tokenB_value").should(
        "have.text",
        "100.00000000 dETH",
      );

      cy.getByTestID("your_lp_tokens_value").should("have.text", "10.00000000");
      cy.getByTestID("your_lp_tokenA_value_rhsUsdAmount").should(
        "have.text",
        "$10,000.00",
      );

      // 39.3427 * 100
      cy.getByTestID("apr_total_value").should("have.text", "3,934.27%");
    });
  });
});
